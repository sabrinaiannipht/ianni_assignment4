
---
title: "Assessment Week 3"
date: "2025-09-21"
author: "Sabrina Ianni 260189219"
output: 
  html_document:
    theme: united
    highlight: zenburn
    toc: true
    toc_depth: 1
    toc_float: true
    tabset: true
    code_folding: hide
---





# Introduction
### In this assessment, we will explore different methods of data manipulation through plot reproduction and customization. With `ggplot`, we can gain insights on data using various visualizations.

\newpage

# **Exercise 1: Reproducing and arranging ggplot2 figures**

## *Reproducing the* ***gender*** and the ***ethnicity*** distributions using updated dataset `cleaned_NHANES.csv` to include meaningful names and appropriate category labels:

### *Gender distribution of adult participants:*

```{r plot_gender, echo = FALSE, fig.height = 3.5, fig.width = 5.5}
pacman::p_load(tidyverse, rio, here, cowplot, dplyr, janitor, ggpubr)
cleaned_NHANES <- import(here("cleaned_NHANES.csv"))

# Filter only adults
cleaned_NHANES_adult <- cleaned_NHANES %>%
  filter(age >= 21)

# Create plot
p1 <- ggplot(cleaned_NHANES_adult, aes(x = age, fill = gender)) +
  geom_histogram(binwidth = 5, position = "dodge") +
  labs(
    title = "Number of adult male & female respondents categorized by age",
    x = "Age (years)",
    y = "Count"
  )

p1
```

### *Proportion of male and female respondents categorized by ethnicity:*


```{r ethnicity_plot, echo = FALSE, fig.height = 3, fig.width = 5}
p2 <- ggplot (cleaned_NHANES, aes( x = ethnicity_2, fill = gender)) +
  geom_bar(position = "fill") +
  labs(x = "Ethnicity", 
       title = "Proportion of Male vs Female by Ethnicity")
p2

#will give a proportion, new one only has 6 versus 7, because code 7 was for missing data in the original dataset
```

## *Combining the two plots together using `cowplot` and using `ggarrange()`:* {.tabset}

### Using `cowplot`: 

```{r, echo = FALSE}
plot_grid(p1,p2)
```

### Using `ggarrange()`:

```{r, echo = FALSE, fig.height = 3.5, fig.width = 5.5}
ggarrange(
  p1, p2, nrow = 2, ncol = 1, 
  common.legend = TRUE, legend = "right")
```

## Using cowplot arranges the plots side by side in a sequential row, but will generates two identical legends, taking up space and is redundant. In contrast, using `ggarrange` allows formatting of the layout and legend, creating a visually cleaner, less cluttered appearance.

\newpage

# **Exercise 2: Visualizing key characteristics**

## Exploring the distribution of key variables - specifically: age, gender, and the two ethnicity variables of the `cleaned_NHANES` dataset.

### Here is the NHANES dataset we will be working with: 

```{r datatable cleaned_NHANES}
pacman::p_load(DT)
datatable(cleaned_NHANES, options = list(scrollX = TRUE))
```

## Visualization of the 'age' distribution: 

```{r age_plot, echo = FALSE, fig.height = 3, fig.width = 5, fig.align = 'center'}

age_plot <- ggplot(cleaned_NHANES, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "lightblue", color = "black") +
  labs(title = "Distribution of Age", x = "Age (years)", y = "Count") +
  theme_minimal()
age_plot
```

## There appears to be more respondents between the ages of 0 to 20 years, in comparison to older age groups.From the ages of 20 to 80, there appears to be similar number of respondents ( close to 1500), with slightly less than 1000 respondents for those aged ~75 years of age.

\newpage

## Visualization of the 'gender' distribution:

```{r gender_plot, echo = FALSE, fig.height = 3, fig.width = 5, fig.align = 'center'}

gender_plot <- ggplot(cleaned_NHANES, aes(x = gender, fill = gender)) +
  geom_bar(width = 0.5, color = "black") +
  scale_fill_manual(values = c("Female" = "pink", "Male" = "lightblue"))
  labs(title = "Distribution of Gender", x = "Gender", y = "Count") +
  theme_minimal()
  
gender_plot
```

## The split between male and female respondents is almost the same, but there are slightly more females in this distribution, with close to 15000 participants in each group. 



## We can also look at the age vs gender distribution combined:

```{r age_gender_plot, echo = FALSE, fig.height = 3, fig.width = 5, fig.align = 'center'}

age_gender_plot <- ggplot(cleaned_NHANES, aes(x = age_cat, fill = gender)) +
  geom_bar(position = "dodge") +
  labs(title = "Distribution of Age", x = "Age (years)", y = "Count") +
  theme_minimal()
age_gender_plot
```

## When looking at this distribution, we see an almost even split between male and female. There are slightly more males in the 0-17 age category. This category also has the largest number of participants. The least number of participants is in the 18-24 category, with slightly more females than males in the subsequent age groups from 18 to 60+.


## Visualization of the 'ethnicity_1' distribution:

```{r plot_eth_1, echo = FALSE, fig.height = 3, fig.width = 5, fig.align = 'center'}

plot_eth_1 <-  ggplot(cleaned_NHANES, aes(x = ethnicity_1, fill = ethnicity_1)) +
    geom_bar(color = "black") +
    labs(title = "Distribution of Ethnicity (ethnicity_1)", x = "Ethnicity", y = "Count") +
    theme_minimal() +
  scale_fill_manual(
    values = c("Black" = "green", 
               "Mexican" = "orange", 
               "Other" = "purple",
               "Other Hispanic"= "pink", 
               "White"= "blue")) 
plot_eth_1
```
 
## Here, we see close to 10000 respondents in the "white" category, approximately ~ 5800 in the "black" category, close to ~5000 in the "Mexican" and "Other" categories and ~3000 in the "Other Hispanic" category.

## Visualization of the 'ethnicity_2' distribution:

```{r plot_eth_2, echo = FALSE, fig.height = 3, fig.width = 5, fig.align = 'center'}
plot_eth_2 <- ggplot(cleaned_NHANES, aes(x = ethnicity_2, fill = ethnicity_2)) +
    geom_bar (color = "black") +
    labs(title = "Distribution of Ethnicity (ethnicity_2)", x = "Ethnicity", y = "Count") +
    theme_minimal() +  
   scale_fill_manual(values = c("Asian" = "red",
                "Black" = "green", 
               "Mexican" = "orange", 
                "Other" = "purple",
               "Other Hispanic"= "pink", 
                "White"= "blue"))
plot_eth_2
```

## Similarly to `ethnicity_1`, we have the same representation in the "white", "black", and "Mexican" and "Other hispanic" categories. However, we have the addition of the "Asian" category which account for approximately ~3200 participants, and lowering the "Other" category to approximately ~1400.

## In the above distributions for age, gender and ethnicity,  we can see there are no missing values in the selected variables.

```{r missing_values, echo = FALSE}
sapply(cleaned_NHANES[c("age", 
                        "gender", 
                        "ethnicity_1", 
                        "ethnicity_2")], 
       function(x) sum(is.na(x)))
```



## Now looking at the two ethnicity distributions: 
```{r comb_eth_plots, echo = FALSE, fig.height = 4, fig.width = 6, fig.align = 'center'}
comb_eth_plots <- ggarrange(plot_eth_1, plot_eth_2, 
          nrow = 2, 
          ncol =1, 
          common.legend = FALSE, legend = "right")
comb_eth_plots
```

## We can see `ethnicity_2` includes "Asian", which is missing in `ethnicity_1`. Having an extra category helps better represent the sample diversity. The `ethnicity_2` distribution separates "Other hispanic" and "Asian", giving a clearer distinction, and more accurate analysis of the data. Removing `ethnicity_1` helps avoid confusion or duplicated information.

```{r remove_missing, echo = FALSE}
# remove the unnecessary variable 

cleaned_NHANES_2 <- cleaned_NHANES %>%
  select(-ethnicity_1)
```

```{r save_plots, echo = FALSE, results = "hide"}

#save the above plots, using 'ggsave()'
ggsave(
  "age_plot.png", 
  plot = age_plot, 
  path = here("figures")
)
ggsave(
  "age_gender_plot.png", 
  plot = age_gender_plot, 
  path = here("figures")
)
ggsave(
  "plot_eth_1.png", 
  plot = plot_eth_1, 
  path = here("figures")
)

ggsave(
  "plot_eth_2.png", 
  plot = plot_eth_2, 
  path = here("figures")
)
ggsave(
  "comb_eth_plots.png", 
  plot = comb_eth_plots, 
  path = here("figures")
) 
```

\newpage

# **Exercise 3: Improving ggplot figure for diet study**

## * The orginal figure demonstrates each participants' diet trajectory, however having twenty participants and twenty different colors can clutter the legend and the plot, and can make it more difficult to read the results. 

## * Additionally, with all the lines on one grid, it is difficult to highlight one person's trajectory. Having a plot for each participant can give a better representation of that participant's trajectory. 

## * The color palette used is not visually distinct when plotted on the grid. Some colors are similar and are hard to distinguish when plotted all together.

## * The axes could be more descriptive: 
###   - X axis - instead of "Week", can use "Time (weeks)" or "Weeks since start"
###   - Y axis - can add units to the "Weight" to make it clearer

## * Can use `theme_minimal` to lighten the background of the grid.


## Here is an example of a clearer represenation of the data, highlighting each participants trajectory. Using the `facet_wrap()` function, and plotting each participant on individual scatter plots to allow for a better visualization of each participant's trajectory. 

## In this case, the color palette is acceptable, as each line is on a individual grid. However, the legend remains crowded with 20 participants' data being included, but it is easier to visualize.

\newpage
## The new and improved figure: 

```{r diet_data, echo = FALSE}

diet_data <- import(here("diet.csv"))


ggplot(diet_data, aes(x = Week, y = Weight, color = as.factor(Participant))) +
  geom_line() +
  geom_point(size = 0.5) +
  facet_wrap(~ Participant) +
  theme_minimal() +
  labs(title = "Weight Trajectory by Participant", x = "Weeks since start", y = "Weight (kg)")
```

\newpage

# **Exercise 4: Exploring relationships through visualizations**

## Now we will be looking at the relationships between age, gender, and systolic blood pressure from our `cleaned_NHANES` dataset. Because our original dataset has four different systolic blood pressure (SBP) readings, we will use the average value of systolic blood pressure for each participant. Here is an example of our new categorical variable `sbp_avg` (average systolic blood pressure):

```{r avg_sbp, echo = FALSE}

# Step 1 : create a new variable - average SBP 

library(dplyr)
cleaned_NHANES_3<- cleaned_NHANES_2 %>%
  mutate(
    sbp_avg = rowMeans(select(., systolic_bp_1, systolic_bp_2, systolic_bp_3, systolic_bp_4), 
                       na.rm = TRUE))

cleaned_NHANES_3 %>%
  select(sbp_avg) %>%
  head(3)
```

## Now we want to create a new dataset that includes individuals who have non-missing values for age, gender, and average systolic blood pressure.
```{r new_dataset, echo = TRUE}

# Use filter() function to create a new dataset 
cleaned_NHANES_filtered <- cleaned_NHANES_3 %>%
  filter(!is.na(age), !is.na(gender), !is.na(sbp_avg))
```


## To have a better understanding what the average SBP scores mean for the participants, we will categorize the average SBP measures them into the following categories: 

### Normal : SBP < 120mmHg
### Elevated: SBP = 120 - 129 mmHg
### Stage 1 hypertension: SBP = 130 - 139 mmHg
### Stage 2 hypertension: SBP > or = 140 mmHg


```{R sbp_cat, echo = FALSE}

#Step 3: create a new categorical variable that classifies individuals based on average SBP : 
cleaned_NHANES_filtered_2 <- cleaned_NHANES_filtered %>%
  mutate(
    sbp_cat = factor(case_when(
      sbp_avg < 120 ~ "Normal",
      sbp_avg >= 120 & sbp_avg < 130 ~ "Elevated",
      sbp_avg >= 130 & sbp_avg < 140 ~ "Stage 1 hypertension",
      sbp_avg >= 140 ~ "Stage 2 hypertension"), 
    levels = c(
      "Normal", "Elevated", "Stage 1 hypertension","Stage 2 hypertension")
    )
  )
```

## Looking at our new data we can see how some of the distribution changed: 

## Here is the gender distribution for our new sample: 

```{r new_gender_plot, echo = FALSE, fig.height = 3, fig.width = 5}

ggplot(cleaned_NHANES_filtered_2, aes(x = gender, fill = gender)) +
  geom_bar(width = 0.5, color = "black") +
  scale_fill_manual(values = c("Female" = "pink", "Male" = "lightblue")) + 
  labs(title = "Distribution of Gender", x = "Gender", y = "Count") +
  theme_minimal()

```

## We can see we still have similar proportion of male to female, but the total number of participants is less due to only including those participants with non missing data ( about 11000 vs 15000 from the original data).


## Now we'll look at the age distribution of our data. We see how the distribution remains nearly the same as our original data, with most participants aged from 0-20. However, there are much less participants in the younger age groups from our filtered data. 

```{r new_age_plot, echo = FALSE, fig.height = 3, fig.width = 5}

new_age_plot <- ggplot(cleaned_NHANES_filtered_2, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Age - Filtered", x = "Age (years)", y = "Count") +
  theme_minimal()

```


## When comparing the age groups between the two datasets, we can see the differences here:

```{r compare_age_plots, echo = FALSE}
ggarrange(age_plot, new_age_plot, nrow =1)
```


## Next, we will look at the differences in blood pressure between males and females: 

```{r gender_avg_sbp, echo = FALSE, fig.height = 4, fig.width = 6}

ggplot(cleaned_NHANES_filtered_2, aes(x = sbp_cat, fill = gender)) +
  geom_bar(position = "dodge") +
  labs(x = "Systolic blood pressure categories", Title = "Systolic Blood Pressure vs Gender")
```

## We can see from this bar plot above most people categorized in the "normal" group, with more females than male. This trend is likely explained by the younger age distribution of participants, as younger individuals are generally healthier. 

## There are more men than women in the "Elevated" and "Stage 1 hypertension" groups, with slightly more women than men in the "Stage 2 hypertension" category.



## Similarly, we can analyze mutiple variables from our original and filtered data. Looking at the age and gender distribution below, we see similar counts in males and females across all age categories, and again, we now see a larger proportion of the participants aged 25 to 60+ in the filtered data (those with non missing values):

```{r compare_plots, echo = FALSE}

#compare from exercise 2 - age/gender distribution 
#plot from original data
p7 <- ggplot(cleaned_NHANES, aes(x = age_cat, fill = gender)) +
  geom_bar(position = "dodge") +
  labs(title = "Original Data")

# Plot from new data
p8 <- ggplot(cleaned_NHANES_filtered_2, aes(x = age_cat, fill = gender)) +
  geom_bar(position = "dodge") +
  labs(title = "Filtered Data")

# Combine them
ggarrange(p7, p8, nrow = 1, common.legend = TRUE, legend = "right")
```

## Lastly, we will look at how hypertension changes across age in men and women: 
```{r sbp_age_gender, echo = FALSE}

ggplot(cleaned_NHANES_filtered_2, aes(x = age, fill = sbp_cat)) +
  geom_histogram(binwidth = 5, color = "black", position = "stack") +
  facet_wrap(~ gender) +
  scale_fill_viridis_d(option = "plasma") + 
  labs(
    title = "Distribution of SBP Categories Across Age and Gender",
    x = "Age (years)",
    y = "Count",
    fill = "SBP Category"
  ) +
  theme_minimal()
```

## When looking at the data above, there are similar counts in both males and females. Secondly, we see the younger participants have "Normal" blood pressure in both men and women, as expected in younger, generally healthier individuals. However, we see more men than women developping elevated SBP earlier on in life. Across both genders, we see higher number of individuals with "Stage 1" and "Stage 2" hypertension as age increases.


## *End of analysis*












